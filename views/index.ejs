<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>URL Shortener</title>
    <link rel="stylesheet" href="style.css"/>
</head>
<body>
    <div class="container">
        <h1>URL Shortener</h1>
        <form action="/" method="post">
            <div>
                <label for="url">Enter URL:</label>
                <input type="url" name="url" id="url" required/>   
            </div>
            <div>
                <label for="shortCode">Shortened URL:</label>
                <input type="text" name="shortCode" id="shortCode" required/>
            </div>
            <button type="submit">Shorten</button>
            
        </form>

        <h2>Shortened URLs</h2>
        <ul >
            <!-- {{shortened_urls}} -->
                <!-- Object.entries(links)
                 .map(
                    ([shortCode,url])=>{
                        url=url.length>=30 ? `${url.slice(0,30)}...` : url;
                        return `<li><a href="/${shortCode}" target="_blank">${host}/${shortCode}</a> -> ${url}</li>`
        })
            .join(""); -->

            <% Object.entries(links).map(([shortCode,url])=> { %>
                <%  const truncatedURL=url.length>=30 ? `${url.slice(0,50)}...` : url %>
            <li>
                <a href="/<%= shortCode %>" target ="_blank">
                <%= host %>/<%= shortCode %>
                </a>-> <%= url %>
            </li>
        <% }) %>
        
        </ul>
    </div>

    <script>
        // const fetchShortenedURL=async()=>{
        //     const response =await fetch("/links");
        //     const links=await response.json();
        //     console.log("links",links);

        //     const list =document.getElementById('shortened-urls');
        //     list.innerHTML="";

        //     for (const[shortCode,url] of Object.entries(links)){
        //         const li= document.createElement('li');

        //         const truncatedURL= url.length>=30?`${url.slice(0,30)}...`:url;

        //         li.innerHTML=`<a href="/${shortCode}" target="_blank">${window.location.origin}/${shortCode}</a> - ${truncatedURL}`;
        //         list.appendChild(li)
        //         console.log(`${shortCode}:${url}`);
        //     }
        // }

        // document.getElementById('shorten-form').addEventListener('submit',async(event)=>{
        //     event.preventDefault();

        //     const formData=new FormData(event.target);
        //     const url =formData.get("url");
        //     const shortCode=formData.get("shortCode");

        //     console.log(url,shortCode);

        //     try{
        //         const response=await fetch("/shorten",{
        //             method:"POST",
        //             headers:{"Content-Type":"application/json"},
        //             body:JSON.stringify({url,shortCode})
        //         });

        //         if(response.ok){
        //             fetchShortenedURL();
        //             alert("Form submitted successfully");
        //             event.target.reset();
        //         }
        //         else{
        //             const errorMessage =await response.text();
        //             alert(errorMessage)
        //         }

            
        //     }catch(error){

        //     }

        // })

        // fetchShortenedURL();
    </script>
</body>
</html>